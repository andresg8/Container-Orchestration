matrix:
  include:
    - os: linux
      language: python
      sudo: required
    - os: osx
      language: python
    - os: windows
      language: python

before_install:
#-------------------------------------------------------------------------------
#Specific to Linux
#-------------------------------------------------------------------------------
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then apt-get --version             ; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y $(grep -v -E '(^#|^$)' requirements.apt) ; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then apt list --installed          ; fi

#-------------------------------------------------------------------------------
#Specific to OSX
#-------------------------------------------------------------------------------
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew --version                  ; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew reinstall $(grep -v -E '(^#|^$)' requirements.brw) ; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew list                       ; fi

#-------------------------------------------------------------------------------
#Specific to Windows
#-------------------------------------------------------------------------------
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then choco info choco            ; fi
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then powershell "choco install --no-progress ((gc requirements.cho) -notmatch '^#' -match '\S')" ; fi
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then export PATH="C:\\Python27\\:C:\\Python27\\Scripts\\:$PATH" ; fi
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then choco list --local-only     ; fi

#-------------------------------------------------------------------------------
#Checking environment details (OS-agnostic)
#-------------------------------------------------------------------------------

- echo $TRAVIS_OS_NAME
- which python
- python --version
- which pip
- pip --version

install:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo pip install `grep 'pip==' requirements.pip` ; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sudo pip install `grep 'pip==' requirements.pip` ; fi
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then powershell "python -m pip install ((gc requirements.pip) -match 'pip==')" ; fi
- which pip
- pip --version
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo pip install -r requirements.pip  ; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sudo pip install -r requirements.pip  ; fi
- if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then python -m pip install -r requirements.pip ; fi

#language: python
#python:
#  - "3.6"
#install: 
#  - pip install -r requirements.txt
script:
  - cd ./src
  - pytest
after_success:
 - python orchestrate.py
